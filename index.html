<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0e0e10">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<!-- iOS full-screen helpers -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-512.png">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FAKEREELS — Dopamine Reset Feed</title>
  <meta name="theme-color" content="#0e0e10" />
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    /* ---- Base & Theme ---- */
    :root {
      --bg: #0e0e10;
      --bg-soft: #16161a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #9b87f5;
      --accent-2: #7dd3fc;
      --danger: #ef4444;
      --success: #22c55e;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    [data-theme="light"] {
      --bg: #f7f7f8;
      --bg-soft: #ffffff;
      --text: #0b0b0c;
      --muted: #4b5563;
      --accent: #6d28d9;
      --accent-2: #0369a1;
      --shadow: 0 12px 30px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; }
    body {
      margin: 0; color: var(--text); background: var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      overscroll-behavior-y: contain; /* prevent browser bounce */
    }
    ::-webkit-scrollbar { width: 0; height: 0; }

    /* ---- App Bar ---- */
    .appbar {
      position: fixed; top: 0; left: 0; right: 0; height: 56px; z-index: 40;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 14px; background: linear-gradient(to bottom, rgba(0,0,0,0.5), rgba(0,0,0,0));
      pointer-events: none; /* let feed take scrolls; buttons re-enable */
    }
    .appbar .group { display: flex; gap: 10px; align-items: center; pointer-events: auto; }
    .chip {
      padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,0.08);
      backdrop-filter: blur(8px); font-size: 13px; color: var(--text); border: 1px solid rgba(255,255,255,0.08);
    }
    .logo {
      font-weight: 800; letter-spacing: 0.5px; font-size: 14px;
      padding: 10px 12px; border-radius: 10px; background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12); box-shadow: var(--shadow);
    }

    /* ---- Feed ---- */
    .feed {
      position: relative;
      height: 100vh;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
    .reel {
      position: relative;
      height: 100vh;
      width: 100%;
      scroll-snap-align: start;
      display: grid;
      place-items: center;
      background: var(--bg-soft);
      user-select: none;
    }

    /* Subtle animated gradients to keep visual interest without stimulation */
    .grad {
      position: absolute; inset: 0;
      background: radial-gradient(1200px 800px at 80% 10%, rgba(157, 115, 255, 0.18), transparent 50%),
                  radial-gradient(900px 700px at 10% 90%, rgba(80, 200, 255, 0.12), transparent 55%),
                  linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
      animation: drift 24s ease-in-out infinite alternate;
      filter: saturate(0.9) contrast(1.02);
    }
    @keyframes drift {
      0% { transform: translate3d(0,0,0) scale(1); }
      100% { transform: translate3d(0,-4%,0) scale(1.03); }
    }

    /* ---- Right Action Rail (like/comment/share) ---- */
    .rail {
      position: absolute; right: clamp(8px, 4vw, 22px); bottom: 110px; z-index: 10;
      display: flex; flex-direction: column; gap: 18px; align-items: center;
    }
    .btn {
      width: 54px; height: 54px; display: grid; place-items: center; border-radius: 14px;
      background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(10px); box-shadow: var(--shadow); cursor: pointer;
      transition: transform .1s ease;
    }
    [data-theme="light"] .btn { background: rgba(255,255,255,0.7); border-color: rgba(0,0,0,0.06); }
    .btn:active { transform: scale(0.96); }
    .btn svg { width: 26px; height: 26px; fill: none; stroke: var(--text); stroke-width: 2; }

    .count { font-size: 12px; color: var(--muted); text-shadow: 0 1px 2px rgba(0,0,0,0.35); text-align: center; }

    /* ---- Bottom Info Bar ---- */
    .meta {
      position: absolute; left: clamp(10px, 4vw, 22px); right: clamp(84px, 15vw, 140px); bottom: 28px; z-index: 10;
      display: grid; gap: 6px;
    }
    .handle { font-weight: 700; font-size: 15px; }
    .caption { font-size: 14px; line-height: 1.35; color: var(--muted); }
    .audio { display: inline-flex; align-items: center; gap: 8px; font-size: 12px; color: var(--muted); opacity: 0.9; }

    /* ---- Breathing Coach ---- */
    .breath {
      position: relative; width: min(64vmin, 420px); height: min(64vmin, 420px);
      border-radius: 999px; display: grid; place-items: center;
      color: var(--text); text-align: center;
      background: radial-gradient(closest-side, rgba(255,255,255,0.08), rgba(255,255,255,0.02) 70%, transparent 80%);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 60px rgba(255,255,255,0.06), var(--shadow);
      overflow: hidden;
    }
    .breathPulse {
      position: absolute; inset: 0; border-radius: 999px; background: radial-gradient(circle at 50% 50%, rgba(156,163,175,.25), transparent 60%);
      animation: breathe 8s ease-in-out infinite;
      filter: blur(10px);
    }
    @keyframes breathe {
      0%   { transform: scale(0.86); opacity: .7; }
      50%  { transform: scale(1.04); opacity: 1; }
      100% { transform: scale(0.86); opacity: .7; }
    }
    .breathText { font-size: clamp(18px, 3vw, 24px); font-weight: 600; }
    .breathSub { margin-top: 8px; font-size: 13px; color: var(--muted); }

    /* ---- Nudger (gentle timer) ---- */
    .nudger {
      position: fixed; inset: 0; z-index: 50; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.55); backdrop-filter: blur(6px);
    }
    .nudgerCard {
      width: min(92vw, 520px); border-radius: 22px; background: var(--bg-soft);
      border: 1px solid rgba(255,255,255,0.1); box-shadow: var(--shadow); padding: 20px;
    }
    .nudgerCard h3 { margin: 0 0 10px 0; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    .primary { background: var(--accent); color: white; border: none; }
    .secondary { background: transparent; color: var(--text); border: 1px solid rgba(255,255,255,0.15); }
    .ghost { background: transparent; color: var(--muted); border: 1px dashed rgba(255,255,255,0.15); }
    .control { padding: 10px 14px; border-radius: 12px; cursor: pointer; }

    /* ---- Tiny settings sheet ---- */
    .sheet {
      position: fixed; right: 10px; top: 64px; z-index: 45; display: none; min-width: 260px;
      padding: 12px; border-radius: 14px; background: var(--bg-soft); border: 1px solid rgba(255,255,255,0.12);
      box-shadow: var(--shadow);
    }
    .sheet label { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 8px 4px; font-size: 14px; }
    .sheet input[type="range"] { width: 150px; }
    .toggle {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px;
      border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.06); cursor: pointer; font-size: 13px;
    }

    /* ---- Helper ---- */
    .hidden { display: none !important; }
    .sr { position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; }
  </style>
</head>
<body>

  <!-- Top App Bar -->
  <div class="appbar">
    <div class="group">
      <button id="settingsBtn" class="chip" aria-haspopup="true" aria-expanded="false">Settings ⚙️</button>
      <button id="themeBtn" class="chip" title="Toggle theme">Theme</button>
      <button id="soundBtn" class="chip" title="Play/Pause ambient sound" aria-pressed="false">Sound: Off</button>
    </div>
    <div class="group">
      <div class="logo" aria-label="FAKEREELS logo">FAKEREELS</div>
    </div>
  </div>

  <!-- Settings Sheet -->
  <div id="sheet" class="sheet" role="dialog" aria-modal="false" aria-labelledby="sheetTitle">
    <div id="sheetTitle" style="font-weight:700; margin-bottom:8px;">Calm Settings</div>
    <label>Disruption reminder
      <select id="nudgerMinutes" class="toggle" aria-label="Disruption reminder minutes">
        <option value="0">Off</option>
        <option value="5">After 5 min</option>
        <option value="10" selected>After 10 min</option>
        <option value="15">After 15 min</option>
        <option value="30">After 30 min</option>
      </select>
    </label>
    <label>Breathing prompts
      <select id="breathEvery" class="toggle" aria-label="Breathing prompt frequency">
        <option value="0">Off</option>
        <option value="3">Every 3 cards</option>
        <option value="5" selected>Every 5 cards</option>
        <option value="8">Every 8 cards</option>
      </select>
    </label>
    <label>Ambient volume
      <input id="volume" type="range" min="0" max="100" value="30" />
    </label>
  </div>

  <!-- Nudger Overlay -->
  <div id="nudger" class="nudger" aria-hidden="true">
    <div class="nudgerCard">
      <h3>Nice pause. How are you feeling?</h3>
      <p style="color:var(--muted); margin:6px 0 14px;">
        You’ve taken a moment for yourself. Ready to rejoin the world, or want one more minute?
      </p>
      <div class="row">
        <button id="closeNudge" class="control primary">I’m done for now</button>
        <button id="snoozeNudge" class="control secondary">Snooze 1 min</button>
        <button id="disableNudge" class="control ghost">Disable reminder</button>
      </div>
    </div>
  </div>

  <!-- Feed -->
  <main id="feed" class="feed" aria-live="polite"></main>

  <!-- SVG Icons (inline for performance) -->
  <svg class="sr" xmlns="http://www.w3.org/2000/svg">
    <symbol id="ico-heart" viewBox="0 0 24 24">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/>
    </symbol>
    <symbol id="ico-comment" viewBox="0 0 24 24">
      <path d="M21 15a4 4 0 0 1-4 4H8l-5 5V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/>
    </symbol>
    <symbol id="ico-share" viewBox="0 0 24 24">
      <path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7"/>
      <path d="M16 6l-4-4-4 4"/>
      <path d="M12 2v14"/>
    </symbol>
    <symbol id="ico-music" viewBox="0 0 24 24">
      <path d="M9 18V5l12-2v13"/>
      <circle cx="6" cy="18" r="3"/>
      <circle cx="18" cy="16" r="3"/>
    </symbol>
  </svg>

  <script>
    /* =======================
       Minimal Reels/Shorts clone — Dopamine-Detox Edition
       ======================= */

    // ---- Theme ----
    const themeBtn = document.getElementById('themeBtn');
    const userTheme = localStorage.getItem('theme');
    if (userTheme) document.documentElement.setAttribute('data-theme', userTheme);
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', current);
      localStorage.setItem('theme', current);
    }
    themeBtn.addEventListener('click', toggleTheme);

    // ---- Settings Sheet ----
    const settingsBtn = document.getElementById('settingsBtn');
    const sheet = document.getElementById('sheet');
    settingsBtn.addEventListener('click', () => {
      const open = sheet.style.display === 'block';
      sheet.style.display = open ? 'none' : 'block';
      settingsBtn.setAttribute('aria-expanded', String(!open));
    });
    document.addEventListener('click', (e) => {
      if (!sheet.contains(e.target) && e.target !== settingsBtn) sheet.style.display = 'none';
    });

    // ---- Ambient Noise (WebAudio Brown Noise) ----
    const soundBtn = document.getElementById('soundBtn');
    let audioCtx, gainNode, noiseNode, playing = false;
    const volumeSlider = document.getElementById('volume');

    function createBrownNoiseNode(ctx) {
      const bufferSize = 2 * ctx.sampleRate;
      const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      let lastOut = 0.0;
      for (let i = 0; i < bufferSize; i++) {
        const white = Math.random() * 2 - 1;
        output[i] = (lastOut + (0.02 * white)) / 1.02;
        lastOut = output[i];
        output[i] *= 3.5; // amplitude
      }
      const noise = ctx.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;
      return noise;
    }

    function startSound() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      gainNode = audioCtx.createGain();
      noiseNode = createBrownNoiseNode(audioCtx);
      noiseNode.connect(gainNode).connect(audioCtx.destination);
      gainNode.gain.value = volumeSlider.value / 100;
      noiseNode.start();
      playing = true;
      soundBtn.textContent = 'Sound: On';
      soundBtn.setAttribute('aria-pressed', 'true');
    }
    function stopSound() {
      if (noiseNode) { try { noiseNode.stop(); } catch(e){} }
      playing = false;
      soundBtn.textContent = 'Sound: Off';
      soundBtn.setAttribute('aria-pressed', 'false');
    }
    soundBtn.addEventListener('click', () => {
      if (!playing) startSound(); else stopSound();
    });
    volumeSlider.addEventListener('input', () => {
      if (gainNode) gainNode.gain.value = volumeSlider.value / 100;
    });
    document.addEventListener('visibilitychange', () => {
      if (document.hidden && playing) stopSound();
    });

    // ---- Gentle Disruption Timer ----
    const nudger = document.getElementById('nudger');
    const closeNudge = document.getElementById('closeNudge');
    const snoozeNudge = document.getElementById('snoozeNudge');
    const disableNudge = document.getElementById('disableNudge');
    const nudgerSelect = document.getElementById('nudgerMinutes');

    let nudgeTimer = null;
    function scheduleNudge(minutes) {
      if (nudgeTimer) clearTimeout(nudgeTimer);
      if (!minutes || minutes === 0) return;
      nudgeTimer = setTimeout(() => {
        nudger.style.display = 'flex';
        nudger.setAttribute('aria-hidden', 'false');
      }, minutes * 60 * 1000);
    }
    function initNudgeFromSettings() {
      const m = parseInt(localStorage.getItem('nudgerMinutes') || '10', 10);
      nudgerSelect.value = String(m);
      scheduleNudge(m);
    }
    nudgerSelect.addEventListener('change', () => {
      const m = parseInt(nudgerSelect.value, 10);
      localStorage.setItem('nudgerMinutes', String(m));
      scheduleNudge(m);
    });
    closeNudge.addEventListener('click', () => {
      // Soft exit: scroll to top and suggest closing tab
      nudger.style.display = 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    snoozeNudge.addEventListener('click', () => {
      nudger.style.display = 'none';
      scheduleNudge(1);
    });
    disableNudge.addEventListener('click', () => {
      nudger.style.display = 'none';
      localStorage.setItem('nudgerMinutes', '0');
      if (nudgeTimer) clearTimeout(nudgeTimer);
    });

    // ---- Feed (Infinite Scroll Simulation) ----
    const feed = document.getElementById('feed');
    const prompts = [
      "Pause. Inhale for 4, exhale for 6.",
      "Notice 3 things you can feel.",
      "Relax your jaw. Unclench shoulders.",
      "You are in control of your attention.",
      "One slow breath. That’s enough.",
      "Look away for a moment. Blink slowly.",
      "Is this helping? Choose gently."
    ];
    const captions = [
      "Dopamine reset space · breathing & stillness",
      "Take a micro-break. No content, just calm.",
      "Minimal stimuli. Maximum agency.",
      "You’re doing great by doing less.",
      "Quiet is productive, too."
    ];

    const handleNames = ["@calm", "@pause", "@still", "@present", "@gentle"];
    const breathEvery = document.getElementById('breathEvery');

    function makeBreathCard() {
      const wrap = document.createElement('div');
      wrap.className = 'reel';
      wrap.innerHTML = `
        <div class="grad" aria-hidden="true"></div>
        <div class="breath" role="region" aria-label="Breathing coach">
          <div class="breathPulse"></div>
          <div class="breathText" id="breathText">Inhale…</div>
          <div class="breathSub">4–6 breathing · repeat a few cycles</div>
        </div>
        ${metaRail()}
      `;
      // simple guidance cycle
      const text = wrap.querySelector('#breathText');
      let idx = 0;
      const steps = [
        { t: 0,   label: "Inhale…", dur: 4000 },
        { t: 4000, label: "Hold…",  dur: 2000 },
        { t: 6000, label: "Exhale…", dur: 6000 },
        { t: 12000, label: "Pause…", dur: 2000 },
      ];
      function loop() {
        const s = steps[idx % steps.length];
        text.textContent = s.label;
        setTimeout(() => { idx++; loop(); }, s.dur);
      }
      setTimeout(loop, 500);
      return wrap;
    }

    function metaRail() {
      const handle = handleNames[Math.floor(Math.random()*handleNames.length)];
      const caption = captions[Math.floor(Math.random()*captions.length)];
      const prompt = prompts[Math.floor(Math.random()*prompts.length)];
      return `
        <div class="rail" aria-label="Actions">
          <button class="btn" title="Like (visual only)"><svg><use href="#ico-heart"/></svg></button>
          <div class="count">${Math.floor(10+Math.random()*90)}k</div>
          <button class="btn" title="Comment (visual only)"><svg><use href="#ico-comment"/></svg></button>
          <div class="count">${Math.floor(10+Math.random()*500)}</div>
          <button class="btn" title="Share (visual only)"><svg><use href="#ico-share"/></svg></button>
          <div class="count">${Math.floor(10+Math.random()*200)}</div>
        </div>
        <div class="meta">
          <div class="handle">${handle}</div>
          <div class="caption">${prompt} — <span style="opacity:.7">${caption}</span></div>
          <div class="audio"><svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor"><use href="#ico-music"/></svg> Ambient brown noise</div>
        </div>
      `;
    }

    function makeCalmCard() {
      const wrap = document.createElement('div');
      wrap.className = 'reel';
      wrap.innerHTML = `
        <div class="grad" aria-hidden="true"></div>
        ${metaRail()}
      `;
      return wrap;
    }

    function addCards(n=6) {
      const howOften = parseInt(breathEvery.value, 10);
      for (let i=0; i<n; i++) {
        const shouldBreath = howOften > 0 && ( (feed.childElementCount + i) % howOften === 0 );
        feed.appendChild(shouldBreath ? makeBreathCard() : makeCalmCard());
      }
    }

    // Initial load
    addCards(8);

    // Infinite extend
    feed.addEventListener('scroll', () => {
      const nearEnd = feed.scrollTop + feed.clientHeight >= feed.scrollHeight - 2;
      if (nearEnd) addCards(6);
    });

    // Keyboard navigation (desktop): Up/Down jump one card
    function snapTo(direction) {
      const pos = feed.scrollTop;
      const vh = window.innerHeight;
      const target = direction > 0 ? Math.ceil((pos+1)/vh)*vh : Math.floor((pos-1)/vh)*vh;
      feed.scrollTo({ top: target, behavior: 'smooth' });
    }
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown') snapTo(1);
      else if (e.key === 'ArrowUp') snapTo(-1);
    });

    // Settings wiring
    breathEvery.addEventListener('change', () => {
      localStorage.setItem('breathEvery', breathEvery.value);
    });
    const savedBreathEvery = localStorage.getItem('breathEvery');
    if (savedBreathEvery) breathEvery.value = savedBreathEvery;

    initNudgeFromSettings();

    // PWA: register service worker (optional)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{ /* ignore */ });
      });
    }
  </script>
</body>
</html>
